# Exercises Endpoints Implementation Plan

Based on the spec defined in `apps/api/_specs_/routes/exercises.md`.

## Requirements

1. **GET /exercises**: List all exercises for the authenticated user. Orchestrates `SearchExercisesByUser` use case. Returns `ExercisePrimitives[]` wrapped in `{ data }`.

## Folder Structure

```
apps/api/src/
  controllers/
    exercises/
      get-exercises.ts            # NEW
  routes/
    exercises.ts                  # NEW
  index.ts                        # UPDATE - register exercises route
```

## Implementation Details

### Controllers

#### `controllers/exercises/get-exercises.ts`

```typescript
import { container } from "@repo/core/container";
import { SearchExercisesByUser } from "@repo/core/contexts/training/exercises/application/search-exercises-by-user.usecase";
import { DomainError } from "@repo/core/shared/domain/domain-error";
import { factory } from "~/lib/factory";
import { domainError, internalServerError, json } from "~/lib/http-response";

export const getExercisesHandlers = factory.createHandlers(async (c) => {
  try {
    const useCase = container.get(SearchExercisesByUser);
    const user = c.get("user");
    const data = await useCase.execute({ userId: user.id });
    return json(c, { data });
  } catch (error: unknown) {
    if (error instanceof DomainError) {
      return domainError(c, error, 400);
    }
    return internalServerError(c);
  }
});
```

- Resolves `SearchExercisesByUser` from the DI container.
- Extracts `user.id` from the Hono context (set by auth middleware via `ProtectedVariables`).
- Calls `useCase.execute({ userId: string })` which returns `ExercisePrimitives[]`.
- Wraps the result in `{ data }` and returns 200.
- Catches `DomainError` instances and returns 400; all other errors return 500.

### Routes

#### `routes/exercises.ts`

```typescript
import { Hono } from "hono";
import { getExercisesHandlers } from "~/controllers/exercises/get-exercises";

export const exercisesApp = new Hono()
  .get("/", ...getExercisesHandlers);

export type ExercisesAppType = typeof exercisesApp;
```

- Mounts `GET /` which maps to `GET /exercises` when registered on the parent app.
- Exports `ExercisesAppType` for end-to-end type-safe RPC clients.

### Index Registration

#### `index.ts`

Add the import at the top of the file:

```typescript
import { exercisesApp } from "~/routes/exercises";
```

Chain `.route("/exercises", exercisesApp)` onto the app, replacing the TODO comment block. The updated section becomes:

```typescript
  .get("/health", (c) => c.json({ status: "ok" }))
  .route("/exercises", exercisesApp);
```

This removes the placeholder comment `// TODO: Add domain routes here` and its example line, replacing them with the actual route registration.
