# Exercise Metrics Implementation Plan

Based on the spec defined in `packages/core/_specs_/contexts/training/exercise-metrics.md`.

## Requirements

1. **SearchAllExerciseMetrics**: Use case that retrieves all exercise metrics from the repository and returns them as primitives.

## Folder Structure

```
packages/core/
├── tests/contexts/training/
│   └── exercise-metrics/
│       ├── domain/
│       │   ├── exercise-metric-id-mother.ts               # NEW
│       │   ├── exercise-metric-mother.ts                   # NEW
│       │   └── mock-exercise-metric-repository.ts          # NEW
│       └── application/
│           └── search-all-exercise-metrics.test.ts         # NEW
└── src/contexts/training/
    └── exercise-metrics/
        └── application/
            └── search-all-exercise-metrics.usecase.ts      # NEW
```

## Implementation Details

### Test Helpers

#### `tests/contexts/training/exercise-metrics/domain/exercise-metric-id-mother.ts`
```typescript
import { IdMother } from "../../../../shared/domain/id-mother";

export class ExerciseMetricIdMother extends IdMother {}
```

#### `tests/contexts/training/exercise-metrics/domain/exercise-metric-mother.ts`
```typescript
import { faker } from "@faker-js/faker";
import {
  ExerciseMetric,
  type ExerciseMetricPrimitives,
} from "../../../../src/contexts/training/exercise-metrics/domain/exercise-metric";
import { ExerciseMetricIdMother } from "./exercise-metric-id-mother";

export class ExerciseMetricMother {
  static create(params?: Partial<ExerciseMetricPrimitives>): ExerciseMetric {
    const primitives: ExerciseMetricPrimitives = {
      id: ExerciseMetricIdMother.random().value,
      name: faker.lorem.word(),
      type: faker.helpers.arrayElement([
        "count",
        "weight",
        "duration",
        "distance",
      ]),
      relation: faker.helpers.arrayElement(["direct", "inverse"]),
      ...params,
    };
    return ExerciseMetric.fromPrimitives(primitives);
  }
}
```

#### `tests/contexts/training/exercise-metrics/domain/mock-exercise-metric-repository.ts`
```typescript
import { mock } from "bun:test";
import type { ExerciseMetric } from "../../../../src/contexts/training/exercise-metrics/domain/exercise-metric";
import { ExerciseMetricRepository } from "../../../../src/contexts/training/exercise-metrics/domain/exercise-metric-repository";

export class MockExerciseMetricRepository extends ExerciseMetricRepository {
  readonly search = mock(() => {});
  readonly searchAll = mock(() => {});

  returnOnSearchAll(metrics: ExerciseMetric[]): void {
    this.searchAll.mockResolvedValue(metrics);
  }
}
```

### Tests

#### `tests/contexts/training/exercise-metrics/application/search-all-exercise-metrics.test.ts`
```typescript
import { describe, it, expect, beforeEach } from "bun:test";
import { SearchAllExerciseMetrics } from "../../../../../src/contexts/training/exercise-metrics/application/search-all-exercise-metrics.usecase";
import { ExerciseMetricMother } from "../domain/exercise-metric-mother";
import { MockExerciseMetricRepository } from "../domain/mock-exercise-metric-repository";

describe("SearchAllExerciseMetrics", () => {
  let repository: MockExerciseMetricRepository;
  let usecase: SearchAllExerciseMetrics;

  beforeEach(() => {
    repository = new MockExerciseMetricRepository();
    usecase = new SearchAllExerciseMetrics(repository);
  });

  it("returns all exercise metrics as primitives", async () => {
    const metrics = [
      ExerciseMetricMother.create(),
      ExerciseMetricMother.create(),
    ];
    repository.returnOnSearchAll(metrics);

    const result = await usecase.execute();

    expect(result).toEqual(metrics.map((m) => m.toPrimitives()));
  });

  it("returns empty list when no metrics exist", async () => {
    repository.returnOnSearchAll([]);

    const result = await usecase.execute();

    expect(result).toEqual([]);
  });
});
```

### Application Layer

#### `src/contexts/training/exercise-metrics/application/search-all-exercise-metrics.usecase.ts`
```typescript
import { InferDependencies } from "../../../../../di/autoregister";
import type { ExerciseMetricPrimitives } from "../domain/exercise-metric";
import { ExerciseMetricRepository } from "../domain/exercise-metric-repository";

@InferDependencies()
export class SearchAllExerciseMetrics {
  constructor(private readonly repository: ExerciseMetricRepository) {}

  async execute(): Promise<ExerciseMetricPrimitives[]> {
    const metrics = await this.repository.searchAll();
    return metrics.map((metric) => metric.toPrimitives());
  }
}
```
